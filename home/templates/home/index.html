{% extends 'home/base_page.html' %}

{% load i18n %}
{% load account_tags %}
{% load url from future %}
{% load pybb_tags i18n %}

{% block title %}
    <title>Vin la Cvicek</title>
{% endblock %}

{% block navigation %}
    {% if not user.is_authenticated %}
    <div class="navigation">
        <li><div class="in_menu">Welcome, Guest</div></li>
        <li><a href="/account/signup">Register</a></li>
        <li><a href="/account/login">Login</a></li>
        <li><a href="/articles/all">Articles</a></li>
        <li><a class="forum_link" href="/forum">Forum</a></li>
    </div>
    {% else %}
    <div class="navigation">
        <li><div class="in_menu">Welcome, {{ user.username }}</div></li>
        <li><a href="/account/logout">Logout</a></li>
        <li><a href="/account/settings">Settings</a> </li>
        {% if group == 'Officer' %}
            <li><a href="/admin">Admin</a> </li>
        {% endif %}
        <li><a href="/articles/all">Articles</a></li>
        <li><a class="forum_link" href="/forum">Forum</a></li>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
    <div class="content_wrapper">
        {% comment %} insert new stuff here {% endcomment %}
        <div class="article_wrapper">
            {% for newsArticle in newsArticles %}
                <div class="article">
                    <h2 class="article_title"><a href="/articles/get/{{ newsArticle.id }}/">{{ newsArticle.title }}</a></h2>
                    <div class="article_author"> Posted by <i><a href="http://www.vinlacvicek.com/forum/users/{{ newsArticle.author }}/">{{ newsArticle.author }}</a></i> on {{ newsArticle.pub_date|date:"F d. Y H:i" }}</div>

                    {% if newsArticle.thumbnail %}
                        <p class="article_thumbnail"><a href="/media/{{newsArticle.thumbnail}}">
                            <img src="/media/{{newsArticle.thumbnail}}" width="822"/></a></p>
                    {% endif %}

                    <p class="article_body">{{ newsArticle.body | truncatewords_html:500 | safe }}</p>
                    <p class="comment_count">
                        {% for comment, count in comment_count.items %}
                            {% if comment == newsArticle.id %}
                                {% if count == 1 %}
                                    <a href="/articles/get/{{ newsArticle.id }}/">{{ count }} comment</a>
                                {% else %}
                                    <a href="/articles/get/{{ newsArticle.id }}/">{{ count }} comments</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </p>

                </div>
            {% endfor %}
        </div>
    </div>
    <div class="sidebar">
        <div class="sidebar_statement">
            Recruitment:
        </div>
        <div class="recruitment">
            {% for recruits in recruitment %}
                <div class="class_entity">
                    <li class="class_name"><img src="/media/{{ recruits.class_name.pic }}"/> {{ recruits.class_name }} </li>
                    <li class="class_role">{{ recruits.class_role }}</li>
                </div>
            {% endfor %}
        </div>
        <div class="apply_button">
                {% comment %} <a href="/apply">Application info</a> {% endcomment %}
                <input type="button" name="delete" value="Application info" onclick="location.href = '/apply'" class="submit_button"/>
        </div>
        <div class="latest_forum">
            {% include "home/latest_topics.html" %}
        </div>
        <div class="sidebar_statement">
            Chatterbox:
        </div>
        <div class="chatterbox">
            {% for chat in chatterbox %}
                <div class="chat_line">
                    <div class="chat_author">
                        <i><a href="http://www.vinlacvicek.com/forum/users/{{ chat.author }}/">{{ chat.author }}</a></i> on {{ chat.pub_date|date:"M d. Y H:i" }}
                    </div>
                    <div class="chat_body">
                        {{ chat.body }}
                    </div>
                    {% if user.username == chat.author.username or  group == 'Officer' %}
                        <div class="chat_delete">
                            <a href="/deletechat/{{ chat.id }}">Delete</a>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        {% if  user.is_authenticated %}
            <div class="chatterbox_form">
                <div class="chatterbox_form_container">
                    <form action="/" method="post" enctype="multipart/form-data"> {% csrf_token %}
                        {% for field in form %}
                            <div class="chatterbox_form_input">{{ field }}</div>
                        {% endfor %}
                        <div class="chatterbox_form_button"><input type="submit" name="chatterbox_form" value="Send" class="submit_button"></div>
                    </form>
                </div>
            </div>

        {% else %}
            <div class="chat_log_in"><a href="/account/login/">Log in</a> or <a href="/account/signup/">register</a> to use the chat.</div>
        {% endif %}
        <div class="sidebar_statement">
            Warcraftlogs:
        </div>
        <div class="logs">
            {% for logs in logs_list %}
                {% comment %}
                <li style="list-style: none"><a href="https://www.warcraftlogs.com/reports/{{ logs.id }}">{{ logs.title }}</a></li> {{ logs.start|unix_to_date }}
                {% endcomment %}
                <div class="log_entity">
                    <li class="log_name"><b><a href="https://www.warcraftlogs.com/reports/{{ logs.id }}">{{ logs.title|truncatechars:35 }}</a></b></li>
                    <li class="log_date"><i>{{ logs.owner }}</i> - {{ logs.start|unix_to_date }}</li>
                </div>
            {% endfor %}
        </div>
        {% comment %} }
        <div class="sidebar_statement">
            Realm status:
        </div>
        <table class="realm_status">
            {% for rstatus in realm_status %}
                {% if rstatus.status  %}
                        <tr><td class="realm_name">{{ rstatus.id }} </td><td><div class="realm_status_up"></div></td></tr>
                {% elif not rstatus.status %}
                        <tr><td class="realm_name">{{ rstatus.id }} </td><td><div class="realm_status_down"></div></td></tr>
                {% endif %}
            {% endfor %}
        </table>
        {% endcomment %}

    </div>
{% endblock %}


{% block footer %}
    <div class="footer_div">
        <table class="realm_status">
            <tr>
                <td class="footer_table">Vin la Cvicek, Horde</td>
                <td class="footer_table">Mazrigos-EU </td>
                {% for rstatus in realm_status %}
                    {% if rstatus.status  %}
                        <td class="footer_table"><div class="realm_status_up" title="Mazrigos is up"></div></td>
                    {% elif not rstatus.status %}
                        <td class="footer_table"><div class="realm_status_down" title="Mazrigos is down"></div></td>
                    {% endif %}
                {% endfor %}
                <td class="footer_table">. Drinking since 2005</td>
            </tr>
        </table>
    </div>
    <div class="footer_div  ">
        Contact Frostmaster or Bishi ingame
    </div>
{% endblock %}
