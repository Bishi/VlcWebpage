{% extends 'home/base_page.html' %}

{% load i18n %}
{% load account_tags %}
{% load url from future %}
{% load pybb_tags i18n %}

{% block title %}
    <title>Vin la Cvicek</title>
{% endblock %}

{% block navigation %}
    {% if not user.is_authenticated %}
    <div class="navigation">
        <li><div class="in_menu">Welcome, Guest</div></li>
        <li><a href="/account/signup">Register</a></li>
        <li><a href="/account/login">Login</a></li>
        <li><a href="/articles/all">Articles</a></li>
        <li><a href="/roster">Roster</a></li>
        <li><a class="forum_link" href="/forum">Forum</a></li>
    </div>
    {% else %}
    <div class="navigation">
        <li><div class="in_menu">Welcome, {{ user.username }}</div></li>
        <li><a href="/account/logout">Logout</a></li>
        <li><a href="/account/settings">Settings</a> </li>
        {% if group == 'Officer' %}
            <li><a href="/admin">Admin</a> </li>
        {% endif %}
        <li><a href="/articles/all">Articles</a></li>
        <li><a href="/roster">Roster</a></li>
        <li><a class="forum_link" href="/forum">Forum</a></li>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
    <div class="content_wrapper">
        <div class="article_wrapper">
            {% for newsArticle in newsArticles %}
                <div class="article">
                    <h2 class="article_title"><a href="/articles/get/{{ newsArticle.id }}/">{{ newsArticle.title }}</a></h2>
                    <div class="article_author"> Posted by <i><a href="http://www.vinlacvicek.com/forum/users/{{ newsArticle.author }}/">{{ newsArticle.author }}</a></i> on {{ newsArticle.pub_date|date:"F d. Y H:i" }}</div>
                    {% if newsArticle.thumbnail %}
                        <p class="article_thumbnail"><a href="/media/{{newsArticle.thumbnail}}">
                            <img src="/media/{{newsArticle.thumbnail}}" width="822"/></a></p>
                    {% endif %}
                    <p class="article_body">{{ newsArticle.body_html | truncatewords_html:500 | safe }}</p>
                    <p class="comment_count">
                        {% for comment, count in comment_count.items %}
                            {% if comment == newsArticle.id %}
                                <a href="/articles/get/{{ newsArticle.id }}/">{{ count }} comment{{ count|pluralize }}</a>
                            {% endif %}
                        {% endfor %}
                    </p>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="sidebar">
        <div class="sidebar_statement">
            Recruitment:
        </div>
        <div class="recruitment">
            {% for recruit in recruits %}
                <div class="class_entity">
                    {% if recruit.spec1.is_needed or recruit.spec2.is_needed or recruit.spec3.is_needed %}
                        <li class="class_name"><img src="/media/{{ recruit.thumbnail }}"/> {{ recruit.name_text }} </li>
                    {% else %}
                        <li class="class_name not_needed"><img src="/media/{{ recruit.thumbnail }}"/> {{ recruit.name_text }} </li>
                    {% endif %}
                    {% if recruit.spec1.is_needed %}
                        <li class="class_role"><img src="/media/{{ recruit.spec1.thumbnail }}"
                                                    title="{{ recruit.spec1.spec_name }}"></li>
                    {% else %}
                        <li class="class_role not_needed"><img src="/media/{{ recruit.spec1.thumbnail }}"
                                                    title="{{ recruit.spec1.spec_name }}"></li>
                    {% endif %}
                    {% if recruit.spec2.is_needed %}
                        <li class="class_role"><img src="/media/{{ recruit.spec2.thumbnail }}"
                                                    title="{{ recruit.spec2.spec_name }}"></li>
                    {% else %}
                        <li class="class_role not_needed"><img src="/media/{{ recruit.spec2.thumbnail }}"
                                                    title="{{ recruit.spec2.spec_name }}"></li>
                    {% endif %}
                    {% if recruit.spec3.is_needed %}
                        <li class="class_role"><img src="/media/{{ recruit.spec3.thumbnail }}"
                                                    title="{{ recruit.spec3.spec_name }}"></li>
                    {% else %}
                        <li class="class_role not_needed"><img src="/media/{{ recruit.spec3.thumbnail }}"
                                                    title="{{ recruit.spec3.spec_name }}"></li>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="apply_button">
                <input type="button" name="delete" value="Application info" onclick="location.href = '/apply'" class="submit_button"/>
        </div>
        <div class="latest_forum">
            {% include "home/latest_topics.html" %}
        </div>
        <div class="sidebar_statement">
            Chatterbox:
        </div>
        <div class="chatterbox">
            {% for chat in chatterbox %}
                <div class="chat_line">
                    <div class="author_container">
                        <div style="height: 16px; width: 16px;">
                            {% include 'pybb/avatar2.html' with user=chat.author %}
                        </div>
                        <div class="chat_author">
                            <i><a href="http://www.vinlacvicek.com/forum/users/{{ chat.author }}/">{{ chat.author }}</a></i> on {{ chat.pub_date|date:"M d. Y H:i" }}
                        </div>
                    </div>
                    <div class="chat_body">
                        {{ chat.body|urlize }}
                    </div>
                    {% if user.username == chat.author.username or  group == 'Officer' %}
                        <div class="chat_delete">
                            <a href="/deletechat/{{ chat.id }}">Delete</a>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        {% if  user.is_authenticated %}
            <div class="chatterbox_form">
                <div class="chatterbox_form_container">
                    <form action="/" method="post" enctype="multipart/form-data"> {% csrf_token %}
                        {% for field in form %}
                            <div class="chatterbox_form_input">{{ field }}</div>
                        {% endfor %}
                        <div class="chatterbox_form_button">
                            <input type="submit" name="chatterbox_form" value="Send" class="submit_button">
                        </div>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="chat_log_in">
                <a href="/account/login/">Log in</a> or <a href="/account/signup/">register</a> to use the chat.
            </div>
        {% endif %}
        <div class="sidebar_statement">
            Warcraftlogs:
        </div>
        <div class="logs">
            {% for logs in logs_list %}
                <div class="log_entity">
                    <li class="log_name"><b><a href="https://www.warcraftlogs.com/reports/{{ logs.id }}">{{ logs.title|truncatechars:35 }}</a></b></li>
                    <li class="log_date"><i>{{ logs.owner }}</i> - {{ logs.start|unix_to_date }}</li>
                </div>
            {% empty %}
                <div class="token_div">
                    No logs available at this time.
                </div>
            {% endfor %}
        </div>
        <div class="sidebar_statement">
            WoW Token price:
        </div>
        <div class="logs">
            {% for token in wow_token %}
                <div class="token_div">
                    <li class="token_timestamp">{{ token.timestamp }}</li>
                    <li class="token_price">{{ token.price }}</li>
                </div>
            {% empty %}
                <div class="token_div">
                    No price available at this time.
                </div>
            {% endfor %}
        </div>
        <div class="sidebar_statement">
            Mount calculator:
        </div>
        <div class="calculator" ng-app="mount_calculator" ng-controller="MountCalculator as calc">
            <div class="calc1">
                <div class="calc2">Number of mounts: </div>
                <div class="calc3">
                    <input type="number" min="0" ng-model="calc.k" required min="0" max="999" style="width: 60px">
                </div>
            </div>
            <div class="calc1">
                <div class="calc2">Drop chance:</div>
                <div class="calc3">
                    <input type="number" min="0" ng-model="calc.p" required min="0" max="100" style="width: 60px" step="0.10"> <span>%</span>
                </div>
            </div>
            <div class="calc1">
                <div class="calc2">Number of kills: </div>
                <div class="calc3">
                    <input type="number" min="0" ng-model="calc.n" required min="0" max="999" style="width: 60px">
                </div>
            </div>
            <div class="calc1">
                <div class="calc2">Chance: </div>
                <div class="res12">
                    {% verbatim %}
                        {{ calc.drop_chance(calc.k, calc.n, calc.p) }}
                    {% endverbatim %}
                </div>
            </div>
            <div class="calc1">
                <div class="calc2">At least one mount:</div>
                <div class="calc3">
                    {% verbatim %}
                        {{ calc.drop_chance_one(0, calc.n, calc.p) }}
                    {% endverbatim %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}